<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@2.0.3"></script>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <title>{% block title %}Campus Events{% endblock %}</title>
  <style>
    .card { @apply rounded-2xl bg-white/90 backdrop-blur shadow-lg ring-1 ring-black/5; }
    .pill { @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ring-1 ring-inset; }
    .field { @apply w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-black/70; }
    .btn  { @apply inline-flex items-center justify-center rounded-xl px-3.5 py-2 text-sm font-semibold bg-black text-white hover:bg-black/90 active:bg-black/80 disabled:opacity-50; }
    .muted{ @apply text-slate-500; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
  <header class="border-b border-slate-200 bg-white/70 backdrop-blur">
    <div class="mx-auto max-w-5xl px-4 sm:px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="h-8 w-8 rounded-xl bg-black text-white grid place-items-center font-bold">CE</div>
        <div class="font-semibold">Campus Events</div>
      </div>
      <nav class="text-sm text-slate-600">
        <a href="/" class="hover:text-slate-900">Home</a>
        <span class="mx-2">•</span>
        <a href="/admin/" class="hover:text-slate-900">Admin</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-5xl p-4 sm:p-6">
    {% block content %}{% endblock %}
  </main>

  <!-- Toast container -->
  <div id="toast-root" class="fixed top-4 right-4 z-50 space-y-2 pointer-events-none"></div>

  <script>
    // Toast helper
    function showToast(msg, kind) {
      const root = document.getElementById('toast-root');
      const el = document.createElement('div');
      const base = "pointer-events-auto rounded-xl shadow-lg ring-1 ring-black/5 px-4 py-3 text-sm flex items-start gap-3";
      let theme = "bg-white text-slate-900";
      if (kind === "success") theme = "bg-emerald-50 text-emerald-900 ring-emerald-200";
      else if (kind === "warn") theme = "bg-amber-50 text-amber-900 ring-amber-200";
      else if (kind === "error") theme = "bg-rose-50 text-rose-900 ring-rose-200";
      el.className = `${base} ${theme}`;
      el.innerHTML = `<div class="font-medium">${msg}</div>`;
      root.appendChild(el);
      setTimeout(() => { el.style.transition = "opacity .2s"; el.style.opacity = "0"; setTimeout(() => el.remove(), 200); }, 2800);
    }

    // HTMX diagnostics + errors → toast
    window.addEventListener('load', () => {
      if (!window.htmx) {
        showToast("HTMX failed to load — falling back to normal submits.", "warn");
      }
    });

    document.body.addEventListener('htmx:responseError', (e) => {
      showToast("Request failed (" + e.detail.xhr.status + "). Check server logs.", "error");
    });
    document.body.addEventListener('htmx:send', (e) => {
      const ind = e.target.closest('form')?.querySelector('[data-indicator]');
      if (ind) ind.classList.remove('hidden');
    });
    document.body.addEventListener('htmx:afterOnLoad', (e) => {
      const ind = e.target.closest('form')?.querySelector('[data-indicator]');
      if (ind) ind.classList.add('hidden');
    });
  </script>

  <footer class="py-10 text-center text-xs text-slate-500">
    Built with Django · HTMX · Tailwind
  </footer>
</body>
</html>
