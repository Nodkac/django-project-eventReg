{% extends "base.html" %}
{% block title %}Events{% endblock %}
{% block content %}

<h1 class="text-3xl font-bold tracking-tight mb-6">Upcoming Events</h1>

<div class="grid gap-5">
  {% for e in events %}
    <section class="card p-5 sm:p-6">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6">
        <div class="md:col-span-8">
          <div class="flex flex-wrap items-center gap-2 mb-2">
            <h2 class="text-xl font-semibold">{{ e.title }}</h2>
            {% if e.is_team_event %}
              <span class="pill text-indigo-700 bg-indigo-50 ring-indigo-200">Team Event</span>
            {% else %}
              <span class="pill text-emerald-700 bg-emerald-50 ring-emerald-200">Individual</span>
            {% endif %}
          </div>

          <p class="text-sm text-slate-600">
            {{ e.start_at|date:"MMM d, Y, g:i a" }}
            {% if e.venue %} · <span class="italic">{{ e.venue }}</span>{% endif %}
          </p>

          {% if e.description %}
            <p class="mt-3 text-slate-700 leading-relaxed">{{ e.description }}</p>
          {% endif %}

          <div class="mt-3 flex items-center gap-3 text-sm">
            <span class="pill bg-slate-50 ring-slate-200 text-slate-700">Capacity: {{ e.capacity }}</span>
            <span id="spots-{{ e.id }}" class="pill bg-slate-900/5 ring-slate-300 text-slate-900 font-semibold">
              Spots left: {{ e.spots }}
            </span>
            {% if e.spots <= 0 %}
              <span class="pill bg-rose-50 ring-rose-200 text-rose-700">Waitlist likely</span>
            {% elif e.spots < 10 %}
              <span class="pill bg-amber-50 ring-amber-200 text-amber-700">Filling fast</span>
            {% endif %}
          </div>
        </div>

        <div class="md:col-span-4">
          {% if e.is_team_event %}
            <form method="post" action="{% url 'register_team' e.id %}"
                  hx-post="{% url 'register_team' e.id %}"
                  hx-target="#status-{{ e.id }}" hx-swap="outerHTML"
                  class="space-y-2">
              {% csrf_token %}
              <label class="text-sm font-medium">Team name</label>
              <input name="team_name" class="field" placeholder="Team name" />
              <label class="text-sm font-medium">Members</label>
              <textarea name="members" rows="4" class="field" placeholder="One per line: Name,email"></textarea>
              <div class="flex items-center justify-between gap-3">
                <button class="btn">Register team</button>
                <span data-indicator class="hidden text-xs muted">Sending…</span>
              </div>
              <p class="muted text-xs">Teams must be {{ e.team_size_min }}–{{ e.team_size_max }} members.</p>
            </form>
          {% else %}
            <form method="post" action="{% url 'register' e.id %}"
                  hx-post="{% url 'register' e.id %}"
                  hx-target="#status-{{ e.id }}" hx-swap="outerHTML"
                  class="space-y-2">
              {% csrf_token %}
              <label class="text-sm font-medium">Your name</label>
              <input name="name" class="field" placeholder="Your name" />
              <label class="text-sm font-medium">Email</label>
              <input name="email" type="email" class="field" placeholder="you@example.com" />
              <div class="flex items-center justify-between gap-3">
                <button class="btn">Register</button>
                <span data-indicator class="hidden text-xs muted">Sending…</span>
              </div>
            </form>
          {% endif %}
        </div>
      </div>

      <div id="status-{{ e.id }}" class="mt-3 text-sm"></div>

      <p class="mt-3 text-xs muted">
        Rule: you may have at most <span class="font-semibold">2 confirmed</span> events. Extra signups go to the waitlist automatically.
      </p>
    </section>
  {% empty %}
    <div class="card p-6 text-center text-slate-600">No events yet.</div>
  {% endfor %}
</div>

{% endblock %}
